apiVersion: fis.fis.dksshddl.dev/v1alpha1
kind: ExperimentTemplate
metadata:
  name: disk-stress-experiment
  namespace: default
spec:
  description: "Inject increasing disk I/O stress on nginx pods"
  
  # 옵션 1: 고객이 직접 생성한 Role 사용 (권장)
  # roleArn: arn:aws:iam::123456789012:role/MyFISRole
  
  # 옵션 2: 자동 생성 (opt-in)
  autoCreateRole: true
  # roleName: fis-experiment-role  # 선택적, 기본값: fis-{namespace}-{templateName}
  
  targets:
  - name: nginx-pods
    namespace: default
    labelSelector:
      app: nginx
    scope: "30%"  # "ALL", "3" (count), "50%" (percent)
  
  actions:
  - name: low-io-stress
    type: pod-io-stress
    duration: 5m
    target: nginx-pods
    parameters:
      percent: "80"
  
  - name: medium-io-stress
    type: pod-io-stress
    duration: 5m
    target: nginx-pods
    parameters:
      percent: "90"
    startAfter:
    - low-io-stress
  
  - name: high-io-stress
    type: pod-io-stress
    duration: 5m
    target: nginx-pods
    parameters:
      percent: "100"
    startAfter:
    - medium-io-stress
  
  stopConditions:
  - source: none
  
  tags:
  - key: Name
    value: "EKS Stress: Disk I/O"
  - key: Environment
    value: "test"
